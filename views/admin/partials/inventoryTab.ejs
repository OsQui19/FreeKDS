<div class="container admin-container inventory-tabs">
  <h1>Inventory</h1>
  <ul class="nav nav-tabs" id="inventoryTabs">
    <li class="nav-item"><a href="#" class="nav-link active" data-pane="ingredientsPane">Ingredients</a></li>
    <li class="nav-item"><a href="#" class="nav-link" data-pane="usageLogPane">Usage Log</a></li>
    <li class="nav-item"><a href="#" class="nav-link" data-pane="usageSummaryPane">Usage Summary</a></li>
    <li class="nav-item"><a href="#" class="nav-link" data-pane="analyticsPane">Analytics</a></li>
  </ul>
  <div class="tab-content">
    <div class="inventory-pane active" id="ingredientsPane">
      <div class="ingredient-list mb-3">
        <div class="header-row">
          <div>Name</div>
          <div>Qty</div>
          <div>Unit</div>
          <div>SKU</div>
          <div>Cost</div>
          <div>Public</div>
          <div></div>
          <div></div>
        </div>
        <% ingredients.forEach(ing => { %>
          <div class="ing-row mb-1">
            <form action="/admin/ingredients" method="POST">
              <input type="hidden" name="id" value="<%= ing.id %>">
              <input class="form-control form-control-sm" type="text" name="name" value="<%= ing.name %>" required>
              <input class="form-control form-control-sm" type="number" step="0.01" name="quantity" value="<%= ing.quantity %>" required>
              <select class="form-select form-select-sm" name="unit_id">
                <option value="">Unit</option>
                <% units.forEach(u => { %>
                  <option value="<%= u.id %>" <%= ing.unit_id === u.id ? 'selected' : '' %>><%= u.abbreviation %></option>
                <% }) %>
              </select>
              <input class="form-control form-control-sm" type="text" name="sku" value="<%= ing.sku || '' %>" placeholder="SKU">
              <input class="form-control form-control-sm" type="number" step="0.01" name="cost" value="<%= ing.cost %>" placeholder="Cost">
              <div class="form-check text-center m-0">
                <input class="form-check-input" type="checkbox" name="is_public" value="1" id="pub-<%= ing.id %>" <%= ing.is_public ? 'checked' : '' %>>
              </div>
              <button type="submit" class="btn btn-primary btn-sm">Save</button>
            </form>
            <form action="/admin/ingredients/delete" method="POST" onsubmit="return confirm('Delete ingredient \"<%= ing.name %>\"?');">
              <input type="hidden" name="id" value="<%= ing.id %>">
              <button type="submit" class="btn btn-secondary btn-sm">Delete</button>
            </form>
          </div>
        <% }) %>
        <form action="/admin/ingredients" method="POST" class="ing-row mt-3">
          <span class="new-label">New:</span>
          <input class="form-control form-control-sm" type="text" name="name" placeholder="Name" required>
          <input class="form-control form-control-sm" type="number" step="0.01" name="quantity" value="0" required>
          <select class="form-select form-select-sm" name="unit_id">
            <option value="">Unit</option>
            <% units.forEach(u => { %>
              <option value="<%= u.id %>"><%= u.abbreviation %></option>
            <% }) %>
          </select>
          <input class="form-control form-control-sm" type="text" name="sku" placeholder="SKU">
          <input class="form-control form-control-sm" type="number" step="0.01" name="cost" value="0" placeholder="Cost">
          <div class="form-check text-center m-0">
            <input class="form-check-input" type="checkbox" name="is_public" value="1" id="new-public">
          </div>
          <button type="submit" class="btn btn-primary btn-sm">Add</button>
          <div></div>
        </form>
      </div>
    </div>

    <div class="inventory-pane" id="usageLogPane">
      <h2>Recent Usage</h2>
      <table class="table">
        <thead>
          <tr><th>Time</th><th>Order</th><th>Item</th><th>Ingredient</th><th>Amount</th></tr>
        </thead>
        <tbody>
        <% logs.forEach(l => { %>
            <tr>
              <td><%= l.created_at.toLocaleString ? l.created_at.toLocaleString() : l.created_at %></td>
              <td><%= l.order_id %></td>
              <td><%= l.item_name %></td>
              <td><%= l.ingredient_name %></td>
              <td><%= l.amount %> <%= l.unit || '' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <div class="inventory-pane" id="usageSummaryPane">
      <h2>Usage Summary</h2>
      <table class="table">
        <thead>
          <tr><th>Ingredient</th><th>Total Used</th></tr>
        </thead>
        <tbody>
          <% summary.forEach(s => { %>
            <tr>
              <td><%= s.name %></td>
              <td><%= s.total %> <%= s.unit || '' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <div class="inventory-pane" id="analyticsPane">
      <h2>Analytics</h2>
      <canvas id="salesChart"></canvas>
      <canvas id="usageChart" class="mt-3"></canvas>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script defer src="/adminInventory.js"></script>
<script defer src="/inventoryTabs.js"></script>
<script defer src="/inventoryAnalytics.js"></script>
