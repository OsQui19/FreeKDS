import{r as l,j as t,e as R,R as w}from"./client.js";function S(){const[n,h]=l.useState([]),[d,y]=l.useState([]),[c,i]=l.useState({});l.useEffect(()=>{async function e(){try{const[s,r,o]=await Promise.all([fetch("/api/hierarchy"),fetch("/api/permissions"),fetch("/api/modules")]),u=await s.json(),m=await r.json(),v=await o.json();h(u.hierarchy||[]),i(m.permissions||{}),y(v.modules||[])}catch(s){console.error(s)}}e()},[]);const a=async e=>{h(e);try{await fetch("/api/hierarchy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hierarchy:e})})}catch(s){console.error(s)}},p=async e=>{i(e);try{await fetch("/api/permissions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({permissions:e})})}catch(s){console.error(s)}},b=e=>{e.preventDefault();const s=e.target.role.value.trim();if(!s||n.includes(s))return;const r=[...n,s];a(r),i(o=>({...o,[s]:[]})),e.target.reset()},f=e=>{if(e<=0)return;const s=[...n];[s[e-1],s[e]]=[s[e],s[e-1]],a(s)},x=e=>{if(e>=n.length-1)return;const s=[...n];[s[e+1],s[e]]=[s[e],s[e+1]],a(s)},g=e=>{const s=n[e],r=n.filter((u,m)=>m!==e),o={...c};delete o[s],a(r),p(o)},N=(e,s)=>{const r=new Set(c[e]||[]);r.has(s)?r.delete(s):r.add(s),p({...c,[e]:Array.from(r)})};return t.jsxs("div",{children:[t.jsx("h5",{children:"Roles"}),t.jsx("p",{className:"text-muted small",children:"Order roles from lowest to highest privilege. The last role has access to everything."}),t.jsx("ul",{className:"list-group mb-2",children:n.map((e,s)=>t.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[t.jsxs("span",{children:[e,s===n.length-1&&t.jsx("span",{className:"badge bg-success ms-2",children:"Highest"})]}),t.jsxs("span",{children:[t.jsx("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>f(s),children:"↑"}),t.jsx("button",{className:"btn btn-sm btn-outline-secondary me-1",onClick:()=>x(s),children:"↓"}),t.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>g(s),children:"×"})]})]},e))}),t.jsxs("form",{onSubmit:b,className:"d-flex",children:[t.jsx("input",{type:"text",name:"role",className:"form-control form-control-sm me-2",placeholder:"New role"}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-primary",children:"Add"})]}),t.jsx("h5",{className:"mt-3",children:"Module Access"}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"table-light",children:[t.jsx("th",{children:"Role"}),d.map(e=>t.jsx("th",{children:e.replace(/-/g," ")},e))]})}),t.jsx("tbody",{children:n.map(e=>t.jsxs("tr",{children:[t.jsx("th",{children:e}),d.map(s=>t.jsx("td",{children:t.jsx("input",{type:"checkbox",checked:(c[e]||[]).includes(s),onChange:()=>N(e,s)})},s))]},e))})]})})]})}function j(){const n=document.getElementById("hierarchyApp");n&&R.createRoot(n).render(t.jsx(w.StrictMode,{children:t.jsx(S,{})}))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j,{once:!0}):j();
